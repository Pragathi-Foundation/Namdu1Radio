<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">

  <title>Media Upload</title>
</head>

<body>
  <div class="container">
    <div class="d-flex flex-column">
      <div class="jumbotron">
        <h2 class="display-5">Media Upload</h2>
        <p class="lead">Upload a picture or video so that everyone can see them in the gallery.</p>
        <hr class="my-4">
        <p>Maximum upload size is 10MB.</p>
      </div>
      <div>
        <div class='input-group'>
          <div class='custom-file'>
            <input type='file' accept='image/*,video/*' class='custom-file-input' id='inputFile' aria-describedby='inputGroupFileAddon04'>
            <label class='custom-file-label' id='inputFileLabel' for='inputFile'>Choose file</label>
          </div>
          <div class='input-group-append'>
            <button class='btn btn-primary' type='button' id='inputFileUploadButton' disabled='true'>Upload</button>
          </div>
        </div>
        <div class='progress'>
          <div id='progressbar' class='progress-bar bg-success' role='progressbar' style='width: 0%' aria-valuenow='0'
            aria-valuemin='0' aria-valuemax='100'></div>
        </div>
      </div>
    </div>
  </div>


  <script>
    var inputFile = document.getElementById("inputFile");
    var inputFileLabel = document.getElementById("inputFileLabel");
    var submitBtn = document.getElementById("inputFileUploadButton");
    var progressBar = document.getElementById("progressbar");

    inputFile.addEventListener('change', handleFileupload);
    submitBtn.addEventListener('click', uploadFile);

    function handleFileupload(e) {
      const file = this.files[0];
      inputFileLabel.innerHTML = file.name;
      submitBtn.disabled = false;
    }


    function uploadFile() {
      var file = inputFile.files[0];
      // alert(file.name+" | "+file.size+" | "+file.type);
      var formdata = new FormData();
      formdata.append("file1", file);
      var ajax = new XMLHttpRequest();
      ajax.upload.addEventListener("progress", progressHandler, false);
      ajax.addEventListener("load", completeHandler, false);
      ajax.addEventListener("error", errorHandler, false);
      ajax.addEventListener("abort", abortHandler, false);
      ajax.open("POST", "file_upload_parser.php"); // http://www.developphp.com/video/JavaScript/File-Upload-Progress-Bar-Meter-Tutorial-Ajax-PHP
      //use file_upload_parser.php from above url
      ajax.send(formdata);
    }

    function progressHandler(event) {
      //_("loaded_n_total").innerHTML = "Uploaded " + event.loaded + " bytes of " + event.total;
      var percent = (event.loaded / event.total) * 100;
      progressBar.setAttribute("style", "width:" + Math.round(percent)+"%");
      progressBar.setAttribute("aria-valuenow",Math.round(percent));
      progressBar.innerHTML=Math.round(percent)+"%";
      console.log(percent);
      //_("status").innerHTML = Math.round(percent) + "% uploaded... please wait";
    }

    function completeHandler(event) {
      //_("status").innerHTML = event.target.responseText;
      alert("Upload successful");
      progressBar.innerHTML = ""; //wil clear progress bar after successful upload
      progressBar.setAttribute("style", "width: 0%");
      window.location = "./index.html"
    }

    function errorHandler(event) {
      alert("Upload Failed");
    }

    function abortHandler(event) {
      alert("Upload Aborted");
    }

  </script>


  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="assets/js/jquery-3.3.1.slim.min.js"></script>
  <script src="assets/js/popper.min.js"></script>
  <script src="assets/js/bootstrap.min.js"></script>
</body>

</html>
